---
title: Consumer Usage Trends in Fitness Wearables
analyst: Carl Ussery
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## The Business Question

How do consumers use smart fitness wearables?

## Analysis Objective: 

Identify insights and trends in smart device trends.

## Business Objective:

To use these insights to drive future marketing of its own line of fitness devices.

## Stakeholders

Bellabeat 
 - Urska Srsen: Co-founder and Chief Creative Officers
 - Sando Mur: Co-founder and member of Bellabeat executive team.
 - Marketing Analytics Team 

# Step 1: Load Packages

```{r load packages}
library(tidyverse) # includes ggplot2 to plot/visualize
library(dplyr) # allows us to aggregate, manipulate, and analyze
library(readr) #allows us to import the .csv files
library(here) #allows for easy file references when importing and exporting
library(janitor) #useful tools and functions for cleaning
library(stringr) #allows us to check string length 
```

# Step 2: Import files

Based on the business question and the dataset, the key metrics we've decided to use in our analysis
are activity, steps, and sleep. We may add/aggregate others if we see the need. 
We're going to import the dailyActivity file, dailySteps file, and sleepDay file"

```{r import files, echo=FALSE}
daily_activity <- read.csv("dailyActivity_merged.csv")
sleep_day <- read.csv("sleepDay_merged.csv")
daily_steps <- read.csv("dailySteps_merged.csv")
```

# Step 3: Clean data

# 3a: Check blanks/nulls/truncated data. Address via "complete or delete".

```{r check for blanks}
lapply(lapply(daily_activity,is.na),table)
lapply(lapply(daily_steps,is.na),table)
lapply(lapply(sleep_day,is.na),table) 
```

# 3b Check for and remove duplicates

```{r check for duplicates}
nrow(daily_activity)
n_distinct(daily_activity)
nrow(daily_steps)
n_distinct(daily_steps)
nrow(sleep_day)
n_distinct(sleep_day)
```

There are 3 duplicates in the sleep_day dataframe 413 vs 410

```{r confirm duplicate}
sum(duplicated(sleep_day))
```

Indeed there are three. Let's drop them and confirm.

```{r remove duplicate}
sleep_day <- distinct(sleep_day)
nrow(sleep_day)
n_distinct(sleep_day)
```

# 3c: ensure consistent and clean columns

```{r clean column names}
daily_activity <- clean_names(daily_activity)
daily_steps <- clean_names(daily_steps)
daily_sleep <- clean_names(sleep_day)

remove(sleep_day)
```

# 3d: ensure consistent typcast

```{r check casttype}
str(daily_activity)
str(daily_steps)
str(daily_sleep)
```

Everything looks fine except the dates. All of them are formatted as  text. 
Let's convert all dates to a standard date format. While we're at it, let's 
rename the date columns in all three to be consistent. 


```{r convert strings to date}
daily_activity <- daily_activity %>% 
  rename(date = activity_date) %>% 
  mutate(date = as_date(date, format = '%m/%d/%Y')) # since what we're converting is a string, we need to identify the month, day, year, hour, etc as well as that which they are delimited by.

daily_steps <- daily_steps %>% 
  rename(date = activity_day) %>% 
  mutate(date = as_date(date, format = '%m/%d/%Y'))

daily_sleep <- daily_sleep %>% 
  rename(date = sleep_day) %>% 
  mutate(date = as_date(date, format = '%m/%d/%Y %I:%M:%S %p',tz=Sys.timezone())) #we had to let it know that "12:00:00 AM" is 12-hour decimal hours (%I)
# and not 24-hour (%H), that the "AM" is the locale/specific AM/PM.
```

# 3e: Ensure consistent strings
```{r string consistency}
str(daily_activity)
str(daily_sleep)
str(daily_steps)
```

It seems the id number should be 10 digits. Let's check.

```{r check string length}
str_length(unique(daily_activity$id))
str_length(unique(daily_sleep$id))
str_length(unique(daily_steps$id))
```
  
# Step 4: Exploratory data analysis

Q1: How many users do we have?

```{r count users}
n_distinct(daily_activity$id) # (All) 33 users provided daily activity data.
n_distinct(daily_steps$id) # ditto for step data. No surprise as step data is one of the variables in daily activity.
n_distinct(daily_sleep$id) # 24/33 provided sleep data. 
```

Q2: Are the observations in `daily_steps` redundant with regards to those in `daily_activity`?

```{r summary of both dataframes}
daily_activity %>% 
  select(total_steps) %>% 
  summary()

daily_steps %>% 
  select(step_total) %>% 
  summary() 
```

They are the exact same. So, we will exclude daily_steps from our analysis as the data is redundant. 

```{r remove redundant dataframe}
remove(daily_steps)
```

Q3: How many days were the users tracking data?

```{r count n of days}
n_distinct(daily_activity$date) # 31 days
n_distinct(daily_sleep$date) # 31 days
```

Q4: Do the activity and sedentary minutes for each day sum to a specific amount?

```{r relevancy of activity minutes}
total_activity_min <- daily_activity %>% 
  group_by(id) %>% 
  filter(date == '2016-04-12') %>% 
  summarize(sum(very_active_minutes,fairly_active_minutes,lightly_active_minutes,sedentary_minutes))

view(total_activity_min)

total_activity_min %>% 
  select(`sum(...)`) %>% 
  summary() # min = 789, mean = 1255, 3rd qu = 1440, and max =1440

n_distinct(total_activity_min$`sum(...)`) # returns a count of 15
n_distinct(total_activity_min$id) # returns a count of 33
nrow(total_activity_min)

nrow(total_activity_min[total_activity_min$`sum(...)` == '1440',]) # count is 19. 
```

Now we know that out of the 33 users, 19 had 1440 total activity minutes measured for 2016-04-12.
What's the significance of this number?

```{r min to hr calculation}
1440/60
```

Equals 24 hours. So, that means that if a user's activity minutes on any given day totals 1440, 
they've tracked an entire 24hr period. Interesting. 19/33 have done so on the first day. 
Later on in our analysis, we can aggregate these "full-time" users if we choose to.

#Q4: Do sleep minutes and sedentary minutes overlap?

Answer: Logically speaking, they do. Full-time use of the device means that 
all activity minutes in a day = all minutes in a day (see previous question).
A portion of the day's minutes are minutes spent sleeping and a portion of all 
activity minutes are sedentary. Sleeping is a sedentary activity, Therefore, 
sleeping minutes should be considered sedentary minutes. The expectation is that 
a) sedentary minutes should exceed sleeping minutes and b) sleeping minutes 
should never exceed sedentary minutes. Let's test this by first combining the 
two dataframes, then getting a statistical summary of it:

```{r combine dataframes}
daily_activity_sleep <- merge(daily_activity,daily_sleep, by = c('id','date'))
glimpse(daily_activity_sleep) 

daily_activity_sleep %>% 
  select(sedentary_minutes,total_minutes_asleep) %>% 
  summary()
```

A statistical summary analysis reveals that sedentary minutes exceed sleeping 
minutes by a fair amount. However, the minimums reveal that the minimum of the 
sedentary_minutes column is 0 while the minimum of the total_minutes_asleep is 
58. There could be any number of reasons for this anomaly. Let's just take the 
average of each user. This will also double as useful info we want to move 
forward with in our analysis:

```{r add aggregate columns}
test_calc_track <-cbind(daily_activity_sleep,
                        total_tracking_min = rowSums(daily_activity_sleep[11:14]))  
  
test_calc_act <- cbind(test_calc_track,total_min_active = rowSums(test_calc_track[11:13]))

head(test_calc_act)

test_calc_ut <- cbind(test_calc_act,uptime_percent = round((rowSums(daily_activity_sleep[11:14])/1440)*100))

daily_activity_sleep <- test_calc_ut


daily_avg <- daily_activity_sleep %>% 
  group_by(id) %>% 
  summarise(avg_steps=round(mean(total_steps)),avg_tracking_min=round(mean(total_tracking_min)),
            avg_uptime_percent = round(mean(uptime_percent)),
            avg_active_min=round(mean(total_min_active)),
            avg_sedentary_min=round(mean(sedentary_minutes)),
            avg_sleep_min=round(mean(total_minutes_asleep)))

view(daily_avg) 

daily_avg %>% 
  filter(avg_sleep_min > avg_sedentary_min)
```

In 1 out of 24 cases, the sleep exceeds the sedentary. It appears to be
an anomaly. 

# Step 4: Analysis: Observation of trends and relationships

# Observation 1: The more steps users took, the more active they became.

```{r Observation 1, message=FALSE, warning=FALSE}
ggplot(daily_activity_sleep) +
  geom_jitter(mapping=aes(x=total_steps, y=total_min_active),color = 'blue', alpha = 0.3) +
  geom_smooth(mapping=aes(x=total_steps, y=total_min_active), color = 'black') +
  labs(title = 'Total Steps vs. Total Active Minutes', subtitle = 'Based on 33 Fit-Bit Users Over 31 Days, Active minutes = Non-Sedentary Minutes',
       caption = 'Source: https://www.kaggle.com/datasets/arashnic/fitbit')
```

# IMPORTANT: 
Surprisingly, the inverse isn't as true. There is only a very slight 
negative correlation between sedentary minutes and steps taken (i.e. taking more steps
doesn't necessarily equate to less sedentary minutes). Perhaps the reason is that
being sedentary for long periods of time is not a trait exclusive to those who don't walk.
For instance, career choice may play a role. 

```{r Observation 1a, message=FALSE, warning=FALSE}
daily_activity_sleep %>% 
  ggplot(aes(x = total_steps, y = sedentary_minutes)) +  
  geom_point(alpha = 0.3,  position = position_jitter(),color='blue') + stat_smooth(color ='black') +
  labs(title = 'Total Steps vs. Sedentary Minutes', subtitle = 'Based on 33 Fit-Bit Users Over 31 Days',
       caption = 'Source: https://www.kaggle.com/datasets/arashnic/fitbit')
```
# Observation 2: The more sedentary users became, the LESS they rended to sleep. 

```{r observation 2, message=FALSE, warning=FALSE}
ggplot(daily_activity_sleep) +
  geom_jitter(mapping=aes(x=sedentary_minutes, y=total_minutes_asleep),color = 'purple', alpha=0.3) +
  stat_smooth(mapping=aes(x=sedentary_minutes, y=total_minutes_asleep),color = 'black') +
  labs(title = 'Sedentary Minutes vs. Sleep Minutes', subtitle = 'Based on 24 Fit-Bit Users Over 31 Days',
       caption = 'Source: https://www.kaggle.com/datasets/arashnic/fitbit')
```
# Observation 3: Users who wore their devices longer (tracking more activity) tended to sleep less.

```{r Observation 3, message=FALSE,warning=FALSE}
ggplot(daily_activity_sleep) +
  geom_jitter(mapping=aes(x=uptime_percent, y=total_minutes_asleep),color = 'navy', alpha=0.3) +
  geom_smooth(mapping=aes(x=uptime_percent, y=total_minutes_asleep), color = 'black') +
  labs(title = 'Uptime vs. Sleep Minutes', subtitle = 'Based on 24 Fit-Bit Users Over 31 Days, Uptime = percent of time device actively tracks daily activity',
       caption = 'Source: https://www.kaggle.com/datasets/arashnic/fitbit')
```
# Observation 4: Users who wore their devices longer (tracking more activity) tended to be more sedentary.

```{r observation 4, message=FALSE, warning=FALSE}
ggplot(daily_activity_sleep) +
  geom_jitter(mapping=aes(x=uptime_percent, y=sedentary_minutes),color = 'orange', alpha=0.6) +
  geom_smooth(mapping=aes(x=uptime_percent, y=sedentary_minutes), color = 'black') +
  labs(title = 'Uptime vs. Sedentary Minutes', subtitle = 'Based on 24 Fit-Bit Users Over 31 Days, Uptime = percent of time device actively tracks daily activity',
       caption = 'Source: https://www.kaggle.com/datasets/arashnic/fitbit')
```
# Observation 5: Users who tracked and logged more activity tended to sleeep less. 
```{r observation 5, message=FALSE,warning=FALSE}
ggplot(daily_activity_sleep) +
  geom_jitter(mapping=aes(x=total_minutes_asleep, y=total_tracking_min), color = 'blue2',alpha=0.3) +
  geom_smooth(mapping=aes(x=total_minutes_asleep, y=total_tracking_min), color ='black') +
  labs(title = 'Sleep Minutes vs. Total Activity Tracking Minutes', subtitle = 'Based on 24 Fit-Bit Users Over 31 Days',
       caption = 'Source: https://www.kaggle.com/datasets/arashnic/fitbit')
```
# Observation 6: The more active users were, the more calories they tended to burn. 

```{r observation 6, message=FALSE, warning=FALSE}
ggplot(daily_activity_sleep) +
  geom_jitter(mapping=aes(x=total_min_active, y=calories),color='deeppink',alpha=0.3) +
  geom_smooth(mapping=aes(x=total_min_active, y=calories), color ='black') +
  labs(title = 'Total Active Minutes vs. Calories Burned', subtitle = 'Based on 33 Fit-Bit Users Over 31 Days, Active minutes = Non-Sedentary Minutes',
       caption = 'Source: https://www.kaggle.com/datasets/arashnic/fitbit')
```


# Observation 7: This is no strong negative relationship between activte minutes and sedentary minutes.
What this means in plain English is that based on this data, we can't definitively say that high sedentary time equates to low active time and vice versa. Too many variable come into play such as lifestyle, training style, etc.  
```{r observation 7, message=FALSE,warning=FALSE}
daily_activity_sleep %>% 
  ggplot(aes(x = total_min_active, y = sedentary_minutes)) +  
  geom_point(alpha = 0.3,  position = position_jitter(),color='blue4') + stat_smooth(color ='black') +
  labs(title = 'Total Active Minutes vs. Sedentary Minutes', subtitle = 'Based on 33 Fit-Bit Users Over 31 Days',
       caption = 'Source: https://www.kaggle.com/datasets/arashnic/fitbit')
```

There were no more identifiable trends based on the key metrics chosen for this analysis. 

# Recommendations

Based upon the results of the analysis we recommend the following:

1. Segment smart device users based upon their goals and motivations.
2. Those looking to become more active should be encouraged to track steps.
3. Those who are already very active should be encouraged to track sleep and rest to
   achieve higher quality recovery. 
4. Further analysis is required due to the small sample size of the dataset. With this in mind,
   the recommendatons are merely a starting point. 

# Limitations 

The sample size of the dataset is very small both in terms of the number of users (33) and the time span
of the sample (31 days). No qualitative data was presented in this dataset and thus we do not know
for which purposes the users are using the device let alone the types of activies that are being
undertaken. 